runtime: nodejs18
service: default

env_variables:
  NODE_ENV: production
  PORT: 8080
  MONGODB_URI: ${MONGODB_URI}
  JWT_SECRET: ${JWT_SECRET}
  STRIPE_SECRET_KEY: ${STRIPE_SECRET_KEY}
  STRIPE_PUBLISHABLE_KEY: ${STRIPE_PUBLISHABLE_KEY}
  SMTP_HOST: ${SMTP_HOST}
  SMTP_PORT: ${SMTP_PORT}
  SMTP_USER: ${SMTP_USER}
  SMTP_PASS: ${SMTP_PASS}
  SENTRY_DSN: ${SENTRY_DSN}

automatic_scaling:
  target_cpu_utilization: 0.65
  min_instances: 1
  max_instances: 10
  target_concurrent_requests: 100

resources:
  cpu: 1
  memory_gb: 0.5
  disk_size_gb: 10

handlers:
  - url: /api/.*
    script: auto
    secure: always

  - url: /static
    static_dir: client/public/static
    secure: always

  - url: /uploads
    static_dir: uploads
    secure: always

  - url: /.*
    script: auto
    secure: always

inbound_services:
  - warmup

beta_settings:
  cloud_sql_instances: ${CLOUD_SQL_INSTANCE}

vpc_access_connector:
  name: projects/${PROJECT_ID}/locations/${REGION}/connectors/${CONNECTOR_NAME} 